<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Weather Monitoring System - Bangalore Live</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; margin: 0; color: #333; }
    header { background: linear-gradient(to right, #0078D7, #00aaff); color: white; padding: 30px 20px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    main { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    .card { background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 25px; margin-bottom: 30px; }
    .two-column-section { display: flex; flex-wrap: wrap; gap: 30px; margin-bottom: 30px; }
    .two-column-section > .card { flex: 1; min-width: 300px; margin-bottom: 0; }
    .chart-container { position: relative; width: 100%; height: 350px; }
    .windy-map-iframe { border: 1px solid #ddd; border-radius: 5px; width: 100%; height: 350px; display: block; }
    .section-title { display: flex; align-items: center; font-size: 1.5em; color: #0078D7; margin-bottom: 15px; }
    .remark { font-weight: bold; font-size: 1.3em; color: #0078D7; margin-top: 15px; }
    .sensor-details { margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; font-size: 0.9em; color: #555; }
    .sensor-details p { margin: 5px 0; }
    button { background: #0078D7; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-size: 1em; transition: 0.2s; }
    button:hover { background: #005fa3; }
    iframe { width: 100%; height: 400px; border: none; border-radius: 8px; }
    footer { background-color: #e6e6e6; text-align: center; padding: 20px; font-size: 0.95em; }
    @media (max-width: 768px) { .two-column-section { flex-direction: column; gap: 20px; } .two-column-section > .card { min-width: unset; } }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-cloud-sun"></i> Smart Weather Monitoring System - Bangalore</h1>
    <p>Real-Time Environmental Data with IoT + Live APIs</p>
  </header>

  <main>
    <div class="two-column-section">
      <div class="card">
        <div class="section-title"><i class="fas fa-thermometer-half"></i>&nbspLive Weather Conditions</div>
        <p><strong>Temperature:</strong> <span id="temp">--</span> ¬∞C</p>
        <p><strong>Humidity:</strong> <span id="humidity">--</span> %</p>
        <p><strong>Pressure:</strong> <span id="pressure">--</span> hPa</p>
        <p><strong>Wind Speed:</strong> <span id="wind">--</span> m/s</p>
        <p><strong>Condition:</strong> <span id="condition">--</span></p>
        <p class="remark" id="remark">Fetching latest Bangalore weather data...</p>
      </div>
      <div class="card">
        <div class="section-title"><i class="fas fa-globe"></i>&nbspLive Weather Map (Windy)</div>
        <iframe class="windy-map-iframe" src="https://embed.windy.com/embed.html?lat=12.9716&lon=77.5946&zoom=10&level=surface&overlay=wind&product=ecmwf"></iframe>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><i class="fas fa-chart-line"></i>&nbspHistorical Chart</div>
      <div class="chart-container">
        <canvas id="chartCanvas"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="section-title"><i class="fas fa-cogs"></i>&nbspControl Panel</div>
      <button onclick="exportCSV()"><i class="fas fa-download"></i> Export Data</button>
      <button onclick="refreshWeather()"><i class="fas fa-sync-alt"></i> Manual Refresh</button>
    </div>
  </main>

  <footer>
    <p>¬© 2025 Smart Weather IoT Dashboard - Powered by OpenWeatherMap API</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const apiKey = 'YOUR_API_KEY'; // Replace with your OpenWeatherMap API key
    const city = 'Bangalore';

    const tempEl = document.getElementById('temp');
    const humidityEl = document.getElementById('humidity');
    const pressureEl = document.getElementById('pressure');
    const windEl = document.getElementById('wind');
    const conditionEl = document.getElementById('condition');
    const remarkEl = document.getElementById('remark');

    let chart;
    let dataPoints = [];

    async function fetchWeather() {
      try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`);
        const data = await res.json();

        const { temp, humidity, pressure } = data.main;
        const wind = data.wind.speed;
        const condition = data.weather[0].description;

        tempEl.textContent = temp.toFixed(1);
        humidityEl.textContent = humidity;
        pressureEl.textContent = pressure;
        windEl.textContent = wind;
        conditionEl.textContent = condition;

        remarkEl.textContent = getRemark(temp, humidity, condition);

        const now = new Date().toLocaleTimeString();
        dataPoints.push({ time: now, temp: temp.toFixed(1), hum: humidity });
        if (dataPoints.length > 20) dataPoints.shift();
        updateChart();
      } catch (error) {
        remarkEl.textContent = 'Failed to fetch live weather data.';
      }
    }

    function getRemark(temp, hum, cond) {
      if (temp > 35 && hum > 60) return 'Hot and Humid - Stay hydrated! ‚òÄÔ∏èüíß';
      if (temp < 20 && cond.includes('rain')) return 'Cool and Rainy - Carry an umbrella ‚òî';
      if (cond.includes('cloud')) return 'Cloudy skies overhead ‚òÅÔ∏è';
      return 'Pleasant weather in Bangalore üå§Ô∏è';
    }

    function updateChart() {
      const labels = dataPoints.map(p => p.time);
      const tempData = dataPoints.map(p => p.temp);
      const humData = dataPoints.map(p => p.hum);

      if (!chart) {
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [
              { label: 'Temperature (¬∞C)', data: tempData, borderColor: '#ff5733', fill: false },
              { label: 'Humidity (%)', data: humData, borderColor: '#0078D7', fill: false }
            ]
          },
          options: { responsive: true, maintainAspectRatio: false }
        });
      } else {
        chart.data.labels = labels;
        chart.data.datasets[0].data = tempData;
        chart.data.datasets[1].data = humData;
        chart.update();
      }
    }

    function exportCSV() {
      let csv = 'Time,Temperature,Humidity\n';
      dataPoints.forEach(p => { csv += `${p.time},${p.temp},${p.hum}\n`; });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'bangalore_weather.csv';
      a.click();
    }

    function refreshWeather() {
      fetchWeather();
    }

    setInterval(fetchWeather, 10000);
    fetchWeather();
  </script>
</body>
</html>
